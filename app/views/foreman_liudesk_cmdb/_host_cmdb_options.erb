<%-
  item = %w[hosts discovered_hosts].include?(controller_name) ? @host : @hostgroup
  facet = item&.liudesk_cmdb_facet

  inherited = false
  if !item&.persisted?
    hostgroup = @hostgroup || @host&.hostgroup
    inherited = facet.nil?
    inherited ||= true if hostgroup&.inherited_facet_attributes(Facets.registered_facets[:liudesk_cmdb_facet])&.any?

    facet ||= item&.build_passwordstate_facet(hostgroup.inherited_facet_attributes(Facets.registered_facets[:liudesk_cmdb_facet])) if inherited && hostgroup
  end
-%>

<%= fields_for item do |f| %>
<%= f.fields_for 'liudesk_cmdb_facet_attributes' do |f| %>
<%= select_f(f, :asset_type, [ ['server', 'Server'], ['client', 'Client'] ], :first, :last,
      { include_blank: true,
        selected: facet&.asset_type,
        disable_button: _(HostsAndHostgroupsHelper::INHERIT_TEXT),
        disable_button_enabled: inherited,
      },
      { help_inline: :indicator,
        label: _('CMDB Asset Type'),
        label_help_options: { data: { placement: 'top' } },
      })
%>
<%# text_f lacks inherit/disable_button functionality %>
<%= field(f, :network_role) do
      input_part = f.text_field :network_role,
                                class: "form-control",
                                disabled: inherited,
                                help_inline: :indicator,
                                label: _('CMDB Network Role'),
                                label_help_options: { data: { placement: 'top' } }
      button_part = content_tag :span, class: "input-group-btn" do
        content_tag :button, _(HostsAndHostgroupsHelper::INHERIT_TEXT), type: "button", href: "#",
                    class: "form-control",
                    name: "is_overridden_btn",
                    onclick: "disableButtonToggle(this)",
                    class: "btn btn-default btn-can-disable #{inherited ? "active" : ""}",
                    data: { toggle: "button", explicit: false }
      end

      input_group input_part, button_part
    end %>
<%-
  end
end
-%>
